FORM by J.Vermaseren,version 3.3(Jul  9 2009) Run at: Tue Jan 10 12:56:33 2017
    *==========================================================================
    *   This file is part of the demos for 
    *    "Generalization of the explicit expression for the Deprit generator 
    *       to  Hamiltonians nonlinearly dependent on small parameter"
    *    Andrey S. Nikolaev (Andrey.Nikolaev@rdtex.ru), 
    *==========================================================================
    *	The normal form of the Pendulum Hamiltonian up to 10th order 
    *	 using the explicit formula  for Deprit generator.
    *       Normalisation in p,q variables.
    *===================================================================
    *          MAXORDER - maximum order in alpha,
    *          NDIM - number of dimensions
    *-------------------- 
    #define MAXORDER	"10"
    #define NDIM    	"1"
    CFunctions sqrt,qurt,asqrt,aqurt; 
    Symbols l,m,n,k,alpha(:{'MAXORDER'}),z, J, cosphi, sinphi,
    *-------------------- 
    *			The canonical variables are:
    *-------------------- 
    #do j=1,'NDIM'
    	zeta'j',eta'j',P'j',Q'j',p'j',q'j'
    #enddo
    ;
    nwrite statistics;
    .global
    *-------------------- 
    *	1. The Hamiltonian in P,Q  variables is:
    *            H = 1/2*P1^2+(1-cos(Q1))
    *-------------------- 
    #define NAME "Pendulum" 
    Global HPQ = 1/2*P1^2 +1 
    #do k=0,{'MAXORDER'+1}
    -(-1)^{'k'}*(Q1)^({2*'k'})/fac_({2*'k'})
    #enddo
    ;
    Bracket Q1;
    Print;
    .store

   HPQ =
       + Q1^2 * ( 1/2 )

       + Q1^4 * (  - 1/24 )

       + Q1^6 * ( 1/720 )

       + Q1^8 * (  - 1/40320 )

       + Q1^10 * ( 1/3628800 )

       + Q1^12 * (  - 1/479001600 )

       + Q1^14 * ( 1/87178291200 )

       + Q1^16 * (  - 1/20922789888000 )

       + Q1^18 * ( 1/6402373705728000 )

       + Q1^20 * (  - 1/2432902008176640000 )

       + Q1^22 * ( 1/1124000727777607680000 )

       + 1/2*P1^2;

    *-------------------- 
    *	2. A scaling transform introduces a small parameter:
    *-------------------- 
    G H=HPQ/alpha;
    #do j=1,'NDIM'
    id P'j'=sqrt(alpha)*p'j';
    id Q'j'=sqrt(alpha)*q'j';
    #enddo
    .sort
    #call eidentities()
    B alpha;
    Print;
    .store

   H =
       + alpha * (  - 1/24*q1^4 )

       + alpha^2 * ( 1/720*q1^6 )

       + alpha^3 * (  - 1/40320*q1^8 )

       + alpha^4 * ( 1/3628800*q1^10 )

       + alpha^5 * (  - 1/479001600*q1^12 )

       + alpha^6 * ( 1/87178291200*q1^14 )

       + alpha^7 * (  - 1/20922789888000*q1^16 )

       + alpha^8 * ( 1/6402373705728000*q1^18 )

       + alpha^9 * (  - 1/2432902008176640000*q1^20 )

       + alpha^10 * ( 1/1124000727777607680000*q1^22 )

       + 1/2*q1^2 + 1/2*p1^2;

    #call frequencies()

   Omega1 =
      1;

    Global Hpq = H;
    B alpha;
    .store
    *-------------------- 
    *	The unperturbed part is as follows:
    *-------------------- 
    Global H0 = Hpq[alpha^0];
    Print;
    .store

   H0 =
      1/2*q1^2 + 1/2*p1^2;

    *-------------------- 
    *     3. The explicit expression for generator is as follows: 
    *-------------------- 
    #call Wpq(e)

Time =      22.82 sec    Generated terms =        440
             eSH         Terms in output =         65
                         Bytes used      =       1802
    Global W =  eSH;
    B alpha;
    Print;
    .store

   W =
       + alpha * ( 17/7680*p1*q1^5 + 1/192*p1^3*q1^3 + 1/512*p1^5*q1 )

       + alpha^2 * ( 1705/8257536*p1*q1^7 + 2161/1966080*p1^3*q1^5 + 451/
         393216*p1^5*q1^3 + 41/131072*p1^7*q1 )

       + alpha^3 * ( 59011/2972712960*p1*q1^9 + 31219/165150720*p1^3*q1^7 + 
         1519/3932160*p1^5*q1^5 + 413/1572864*p1^7*q1^3 + 59/1048576*p1^9*q1 )

       + alpha^4 * ( 4048553/2092789923840*p1*q1^11 + 5507897/190253629440*
         p1^3*q1^9 + 1039247/10569646080*p1^5*q1^7 + 61117/503316480*p1^7*q1^5
          + 12359/201326592*p1^9*q1^3 + 727/67108864*p1^11*q1 )

       + alpha^5 * ( 620238319/3264752281190400*p1*q1^13 + 86125999/
         20927899238400*p1^3*q1^11 + 32030387/1522029035520*p1^5*q1^9 + 216707/
         5284823040*p1^7*q1^7 + 290681/8053063680*p1^9*q1^5 + 5855/402653184*
         p1^11*q1^3 + 1171/536870912*p1^13*q1 )

       + alpha^6 * ( 2632958815033/140410466109436723200*p1*q1^15 + 
         3713890820641/6686212671877939200*p1^3*q1^13 + 97986806293/
         24491621508710400*p1^5*q1^11 + 5037166463/445302209249280*p1^7*q1^9
          + 5263804687/346346162749440*p1^9*q1^7 + 171105431/16492674416640*
         p1^11*q1^5 + 11463407/3298534883328*p1^13*q1^3 + 498409/1099511627776
         *p1^15*q1 )

       + alpha^7 * ( 16124390825653/8679919723128815616000*p1*q1^17 + 
         202656557830549/2808209322188734464000*p1^3*q1^15 + 1696407436753/
         2431350062501068800*p1^5*q1^13 + 264975302969/97966486034841600*p1^7*
         q1^11 + 32028732641/6234230929489920*p1^9*q1^9 + 1450163011/
         277076930199552*p1^11*q1^7 + 192331729/65970697666560*p1^13*q1^5 + 
         11030227/13194139533312*p1^15*q1^3 + 848479/8796093022208*p1^17*q1 )

       + alpha^8 * ( 38566631165554627/208984691189827867823308800*p1*q1^19 + 
         55644216072108691/6110663485082686193664000*p1^3*q1^17 + 
         10239617130140011/89862698310039502848000*p1^5*q1^15 + 
         497321171660981/855835222000376217600*p1^7*q1^13 + 65061689402497/
         43888985743609036800*p1^9*q1^11 + 1672182581801/797981558974709760*
         p1^11*q1^9 + 75989191907/44332308831928320*p1^13*q1^7 + 1701782209/
         2111062325329920*p1^15*q1^5 + 341298709/1688849860263936*p1^17*q1^3
          + 11768921/562949953421312*p1^19*q1 )

       + alpha^9 * ( 948620169728297071/51631511941016296756346880000*p1*q1^21
          + 586633136726116763/522461727974569669558272000*p1^3*q1^19 + 
         11220241010018723/634874128320279085056000*p1^5*q1^17 + 
         2949155038186057/25675056660011286528000*p1^7*q1^15 + 
         5191879217423713/13693363552006019481600*p1^9*q1^13 + 888695438557/
         1253971021245972480*p1^11*q1^11 + 5064266587343/6383852471797678080*
         p1^13*q1^9 + 47988711221/88664617663856640*p1^15*q1^7 + 14875341061/
         67553994410557440*p1^17*q1^5 + 20705249/422212465065984*p1^19*q1^3 + 
         20705249/4503599627370496*p1^21*q1 )

       + 5/192*p1*q1^3 + 1/64*p1^3*q1;

    *--------------------
    *   4. The transformed Hamiltonian U_W H
    *        in p,q variables is as follows:
    *--------------------
    #call Upq(W,Hpq,e)

Time =      22.86 sec    Generated terms =         77
            eU10         Terms in output =         77
                         Bytes used      =       1938
    .store
    G Htpq=eU'MAXORDER';
    B alpha;
    Print;
    .store

   Htpq =
       + alpha * (  - 1/64*q1^4 - 1/32*p1^2*q1^2 - 1/64*p1^4 )

       + alpha^2 * (  - 1/2048*q1^6 - 3/2048*p1^2*q1^4 - 3/2048*p1^4*q1^2 - 1/
         2048*p1^6 )

       + alpha^3 * (  - 5/131072*q1^8 - 5/32768*p1^2*q1^6 - 15/65536*p1^4*q1^4
          - 5/32768*p1^6*q1^2 - 5/131072*p1^8 )

       + alpha^4 * (  - 33/8388608*q1^10 - 165/8388608*p1^2*q1^8 - 165/4194304
         *p1^4*q1^6 - 165/4194304*p1^6*q1^4 - 165/8388608*p1^8*q1^2 - 33/
         8388608*p1^10 )

       + alpha^5 * (  - 63/134217728*q1^12 - 189/67108864*p1^2*q1^10 - 945/
         134217728*p1^4*q1^8 - 315/33554432*p1^6*q1^6 - 945/134217728*p1^8*
         q1^4 - 189/67108864*p1^10*q1^2 - 63/134217728*p1^12 )

       + alpha^6 * (  - 527/8589934592*q1^14 - 3689/8589934592*p1^2*q1^12 - 
         11067/8589934592*p1^4*q1^10 - 18445/8589934592*p1^6*q1^8 - 18445/
         8589934592*p1^8*q1^6 - 11067/8589934592*p1^10*q1^4 - 3689/8589934592*
         p1^12*q1^2 - 527/8589934592*p1^14 )

       + alpha^7 * (  - 9387/1099511627776*q1^16 - 9387/137438953472*p1^2*
         q1^14 - 65709/274877906944*p1^4*q1^12 - 65709/137438953472*p1^6*q1^10
          - 328545/549755813888*p1^8*q1^8 - 65709/137438953472*p1^10*q1^6 - 
         65709/274877906944*p1^12*q1^4 - 9387/137438953472*p1^14*q1^2 - 9387/
         1099511627776*p1^16 )

       + alpha^8 * (  - 175045/140737488355328*q1^18 - 1575405/140737488355328
         *p1^2*q1^16 - 1575405/35184372088832*p1^4*q1^14 - 3675945/
         35184372088832*p1^6*q1^12 - 11027835/70368744177664*p1^8*q1^10 - 
         11027835/70368744177664*p1^10*q1^8 - 3675945/35184372088832*p1^12*
         q1^6 - 1575405/35184372088832*p1^14*q1^4 - 1575405/140737488355328*
         p1^16*q1^2 - 175045/140737488355328*p1^18 )

       + alpha^9 * (  - 422565/2251799813685248*q1^20 - 2112825/
         1125899906842624*p1^2*q1^18 - 19015425/2251799813685248*p1^4*q1^16 - 
         6338475/281474976710656*p1^6*q1^14 - 44369325/1125899906842624*p1^8*
         q1^12 - 26621595/562949953421312*p1^10*q1^10 - 44369325/
         1125899906842624*p1^12*q1^8 - 6338475/281474976710656*p1^14*q1^6 - 
         19015425/2251799813685248*p1^16*q1^4 - 2112825/1125899906842624*p1^18
         *q1^2 - 422565/2251799813685248*p1^20 )

       + alpha^10 * (  - 4194753/144115188075855872*q1^22 - 46142283/
         144115188075855872*p1^2*q1^20 - 230711415/144115188075855872*p1^4*
         q1^18 - 692134245/144115188075855872*p1^6*q1^16 - 692134245/
         72057594037927936*p1^8*q1^14 - 968987943/72057594037927936*p1^10*
         q1^12 - 968987943/72057594037927936*p1^12*q1^10 - 692134245/
         72057594037927936*p1^14*q1^8 - 692134245/144115188075855872*p1^16*
         q1^6 - 230711415/144115188075855872*p1^18*q1^4 - 46142283/
         144115188075855872*p1^20*q1^2 - 4194753/144115188075855872*p1^22 )

       + 1/2*q1^2 + 1/2*p1^2;

    *--------------------
    *   5. The transformed Hamiltonian
    *      in eta,zeta variables is as follows:
    *--------------------
    G Htetazeta=Htpq;
    #call pqtoetazeta()
    B alpha;
    Print;
    .store

   Htetazeta =
       + alpha * ( 1/16*zeta1^2*eta1^2 )

       + alpha^2 * ( 1/256*i_*zeta1^3*eta1^3 )

       + alpha^3 * (  - 5/8192*zeta1^4*eta1^4 )

       + alpha^4 * (  - 33/262144*i_*zeta1^5*eta1^5 )

       + alpha^5 * ( 63/2097152*zeta1^6*eta1^6 )

       + alpha^6 * ( 527/67108864*i_*zeta1^7*eta1^7 )

       + alpha^7 * (  - 9387/4294967296*zeta1^8*eta1^8 )

       + alpha^8 * (  - 175045/274877906944*i_*zeta1^9*eta1^9 )

       + alpha^9 * ( 422565/2199023255552*zeta1^10*eta1^10 )

       + alpha^10 * ( 4194753/70368744177664*i_*zeta1^11*eta1^11 )

       + i_*zeta1*eta1;

    *--------------------
    *   6. The normalised Hamiltonian is commutative with H0:
    *--------------------
    #call Lpq(H0,Htpq)
    Drop Pb'NDIM';
    L delta=Pb'NDIM';
    B alpha;
    Print;
    .store

   delta = 0;

    #if 'NDIM' == 1
    *--------------------
    *   7. The Generator and the transformed Hamiltonian
    *      in Action-Angle variables are as follows:
    *--------------------
    G WAA=W;
    id p1=sqrt(2)*sqrt(J)*cosphi;
    id q1=sqrt(2)*sqrt(J)*sinphi;
    #call eidentities()
    B alpha;
    Print;
    .store

   WAA =
       + alpha * ( 17/960*J^3*cosphi*sinphi^5 + 1/24*J^3*cosphi^3*sinphi^3 + 1/
         64*J^3*cosphi^5*sinphi )

       + alpha^2 * ( 1705/516096*J^4*cosphi*sinphi^7 + 2161/122880*J^4*
         cosphi^3*sinphi^5 + 451/24576*J^4*cosphi^5*sinphi^3 + 41/8192*J^4*
         cosphi^7*sinphi )

       + alpha^3 * ( 59011/92897280*J^5*cosphi*sinphi^9 + 31219/5160960*J^5*
         cosphi^3*sinphi^7 + 1519/122880*J^5*cosphi^5*sinphi^5 + 413/49152*J^5
         *cosphi^7*sinphi^3 + 59/32768*J^5*cosphi^9*sinphi )

       + alpha^4 * ( 4048553/32699842560*J^6*cosphi*sinphi^11 + 5507897/
         2972712960*J^6*cosphi^3*sinphi^9 + 1039247/165150720*J^6*cosphi^5*
         sinphi^7 + 61117/7864320*J^6*cosphi^7*sinphi^5 + 12359/3145728*J^6*
         cosphi^9*sinphi^3 + 727/1048576*J^6*cosphi^11*sinphi )

       + alpha^5 * ( 620238319/25505877196800*J^7*cosphi*sinphi^13 + 86125999/
         163499212800*J^7*cosphi^3*sinphi^11 + 32030387/11890851840*J^7*
         cosphi^5*sinphi^9 + 216707/41287680*J^7*cosphi^7*sinphi^7 + 290681/
         62914560*J^7*cosphi^9*sinphi^5 + 5855/3145728*J^7*cosphi^11*sinphi^3
          + 1171/4194304*J^7*cosphi^13*sinphi )

       + alpha^6 * ( 2632958815033/548478383239987200*J^8*cosphi*sinphi^15 + 
         3713890820641/26118018249523200*J^8*cosphi^3*sinphi^13 + 97986806293/
         95670396518400*J^8*cosphi^5*sinphi^11 + 5037166463/1739461754880*J^8*
         cosphi^7*sinphi^9 + 5263804687/1352914698240*J^8*cosphi^9*sinphi^7 + 
         171105431/64424509440*J^8*cosphi^11*sinphi^5 + 11463407/12884901888*
         J^8*cosphi^13*sinphi^3 + 498409/4294967296*J^8*cosphi^15*sinphi )

       + alpha^7 * ( 16124390825653/16952968209235968000*J^9*cosphi*sinphi^17
          + 202656557830549/5484783832399872000*J^9*cosphi^3*sinphi^15 + 
         1696407436753/4748730590822400*J^9*cosphi^5*sinphi^13 + 264975302969/
         191340793036800*J^9*cosphi^7*sinphi^11 + 32028732641/12176232284160*
         J^9*cosphi^9*sinphi^9 + 1450163011/541165879296*J^9*cosphi^11*
         sinphi^7 + 192331729/128849018880*J^9*cosphi^13*sinphi^5 + 11030227/
         25769803776*J^9*cosphi^15*sinphi^3 + 848479/17179869184*J^9*cosphi^17
         *sinphi )

       + alpha^8 * ( 38566631165554627/204086612490066277171200*J^10*cosphi*
         sinphi^19 + 55644216072108691/5967444809651060736000*J^10*cosphi^3*
         sinphi^17 + 10239617130140011/87756541318397952000*J^10*cosphi^5*
         sinphi^15 + 497321171660981/835776583984742400*J^10*cosphi^7*
         sinphi^13 + 65061689402497/42860337640243200*J^10*cosphi^9*sinphi^11
          + 1672182581801/779278866186240*J^10*cosphi^11*sinphi^9 + 
         75989191907/43293270343680*J^10*cosphi^13*sinphi^7 + 1701782209/
         2061584302080*J^10*cosphi^15*sinphi^5 + 341298709/1649267441664*J^10*
         cosphi^17*sinphi^3 + 11768921/549755813888*J^10*cosphi^19*sinphi )

       + alpha^9 * ( 948620169728297071/25210699189949363650560000*J^11*cosphi
         *sinphi^21 + 586633136726116763/255108265612582846464000*J^11*
         cosphi^3*sinphi^19 + 11220241010018723/309997132968886272000*J^11*
         cosphi^5*sinphi^17 + 2949155038186057/12536648759771136000*J^11*
         cosphi^7*sinphi^15 + 5191879217423713/6686212671877939200*J^11*
         cosphi^9*sinphi^13 + 888695438557/612290537717760*J^11*cosphi^11*
         sinphi^11 + 5064266587343/3117115464744960*J^11*cosphi^13*sinphi^9 + 
         47988711221/43293270343680*J^11*cosphi^15*sinphi^7 + 14875341061/
         32985348833280*J^11*cosphi^17*sinphi^5 + 20705249/206158430208*J^11*
         cosphi^19*sinphi^3 + 20705249/2199023255552*J^11*cosphi^21*sinphi )

       + 5/48*J^2*cosphi*sinphi^3 + 1/16*J^2*cosphi^3*sinphi;

    G Htaa=Htpq;
    id p1^2=2*J-q1^2;
    B alpha;
    Print;
    .store

   Htaa =
       + alpha * (  - 1/16*J^2 )

       + alpha^2 * (  - 1/256*J^3 )

       + alpha^3 * (  - 5/8192*J^4 )

       + alpha^4 * (  - 33/262144*J^5 )

       + alpha^5 * (  - 63/2097152*J^6 )

       + alpha^6 * (  - 527/67108864*J^7 )

       + alpha^7 * (  - 9387/4294967296*J^8 )

       + alpha^8 * (  - 175045/274877906944*J^9 )

       + alpha^9 * (  - 422565/2199023255552*J^10 )

       + alpha^10 * (  - 4194753/70368744177664*J^11 )

       + J;

    *--------------------
    *   8. Birkhoff series for the transformed Hamiltonian 
    *--------------------
    Symbol [P^2+Q^2];
    G HtPQ=Htaa*alpha;
    id J=[P^2+Q^2]/2/alpha;
    B [P^2+Q^2];
    Print;
    .store

   HtPQ =
       + [P^2+Q^2] * ( 1/2 )

       + [P^2+Q^2]^2 * (  - 1/64 )

       + [P^2+Q^2]^3 * (  - 1/2048 )

       + [P^2+Q^2]^4 * (  - 5/131072 )

       + [P^2+Q^2]^5 * (  - 33/8388608 )

       + [P^2+Q^2]^6 * (  - 63/134217728 )

       + [P^2+Q^2]^7 * (  - 527/8589934592 )

       + [P^2+Q^2]^8 * (  - 9387/1099511627776 )

       + [P^2+Q^2]^9 * (  - 175045/140737488355328 )

       + [P^2+Q^2]^10 * (  - 422565/2251799813685248 );

    #endif
    Symbol [p^2+p^2];
    G Hprint=Htpq;
    id q1^2=[p^2+p^2]-p1^2;
    B alpha;
    Print;

   Hprint =
       + alpha * (  - 1/64*[p^2+p^2]^2 )

       + alpha^2 * (  - 1/2048*[p^2+p^2]^3 )

       + alpha^3 * (  - 5/131072*[p^2+p^2]^4 )

       + alpha^4 * (  - 33/8388608*[p^2+p^2]^5 )

       + alpha^5 * (  - 63/134217728*[p^2+p^2]^6 )

       + alpha^6 * (  - 527/8589934592*[p^2+p^2]^7 )

       + alpha^7 * (  - 9387/1099511627776*[p^2+p^2]^8 )

       + alpha^8 * (  - 175045/140737488355328*[p^2+p^2]^9 )

       + alpha^9 * (  - 422565/2251799813685248*[p^2+p^2]^10 )

       + alpha^10 * (  - 4194753/144115188075855872*[p^2+p^2]^11 )

       + 1/2*[p^2+p^2];

    .end
  23.13 sec out of 40.51 sec
